"use strict";(self.webpackChunkprovisioning_frontend=self.webpackChunkprovisioning_frontend||[]).push([[494],{6494:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Te});var r=n(7462),a=n(885),i=n(5987),o=n(5697),c=n.n(o),s=n(1242),l=n(3264),u=n.n(l),p=n(3806);const d={chosenSource:void 0,chosenNumOfInstances:1,chosenInstanceType:void 0,uploadedKey:!1,chosenRegion:"us-east-1",sshPublicName:"",sshPublicKey:"",chosenSshKeyId:void 0,chosenSshKeyName:null};var m=(0,p.fH)((function(){return(0,l.useState)(d)})),f=m.Provider,y=m.useTracked,b=n(8767),h=new b.QueryClient;const g=function(e){var t=e.children;return u().createElement(b.QueryClientProvider,{client:h},t)};var v=n(4942),S=n(4213),O="sources",E="pubkeys",w=n(5861),P=n(7757),j=n.n(P),k=n(5564),I=n.n(k),D=function(e){return"/api/provisioning/v1/".concat(e)},T=function(){var e=(0,w.Z)(j().mark((function e(){var t,n;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I().get(D("sources"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=(0,w.Z)(j().mark((function e(){var t,n;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I().get(D("pubkeys"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(){var e=(0,w.Z)(j().mark((function e(t){var n,r;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I().get(D("instance_types/aws?region=".concat(t)));case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Z=function(){var e=(0,w.Z)(j().mark((function e(t){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I().post(D("reservations/aws"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=(0,w.Z)(j().mark((function e(t){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I().post(D("pubkeys"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,w.Z)(j().mark((function e(t){var n,r;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I().get(D("reservations/".concat(t)));case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L=function(e){var t=e.setValidation,n=y(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=u().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=u().useState(null),f=(0,a.Z)(m,2),h=f[0],g=f[1],v=function(e,t){return{id:e,toString:function(){return t},compareTo:function(t){return t.id===e}}},S=(0,b.useQuery)(O,T,{onSuccess:function(e){var t=i.chosenSource;t&&g(v(t,e.find((function(e){return e.id===t})).name))}}),E=S.error,w=S.isLoading,P=S.data;return E?(console.warn("Failed to fetch sources list"),u().createElement(u().Fragment,null,u().createElement(s.Alert,{ouiaId:"select_account_alert",variant:"warning",isInline:!0,title:"There are problems fetching accounts"}),u().createElement(s.Select,{ouiaId:"select_account_empty",isDisabled:!0,placeholderText:"No accounts found","aria-label":"Select account"}))):w?u().createElement(s.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading accounts"}):u().createElement(s.Select,{ouiaId:"select_account",isOpen:p,onToggle:function(e){return d(e)},selections:h,onSelect:function(e,n,r){r?(g(null),o((function(e){return K(K({},e),{},{chosenSource:null})})),t("error")):(g(n),o((function(e){return K(K({},e),{},{chosenSource:n.id})})),t("success")),d(!1)},placeholderText:"Select account","aria-label":"Select account"},P.map((function(e){var t=e.name,n=e.id;return u().createElement(s.SelectOption,{"aria-label":"Source account",key:n,value:v(n,t)})})))};L.propTypes={setValidation:c().func.isRequired};const V=L;function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const q=function(){var e=y(),t=(0,a.Z)(e,2),n=t[0],r=t[1];return u().createElement(s.Slider,{max:45,min:1,value:n.chosenNumOfInstances,isInputVisible:!0,inputValue:n.chosenNumOfInstances,hasTooltipOverThumb:!0,onChange:function(e,t,n){var a;void 0===t?a=Number(e):t>45?(a=45,n(45)):t<1?(a=1,n(1)):a=Math.floor(t),r((function(e){return B(B({},e),{},{chosenNumOfInstances:a})}))}})};function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e){var t=e.setValidation,n=y(),i=(0,a.Z)(n,2),o=i[0],c=i[1],l=u().useState(!1),p=(0,a.Z)(l,2),d=p[0],m=p[1],f=u().useState(5),h=(0,a.Z)(f,2),g=h[0],v=h[1],S=u().useState(null),O=(0,a.Z)(S,2),E=O[0],w=O[1],P=u().useState(""),j=(0,a.Z)(P,2),k=j[0],I=j[1],D=(0,b.useQuery)(["instanceTypes",o.chosenRegion],(function(){return x(o.chosenRegion)})),T=D.isLoading,_=D.error,Z=D.data;if(!o.chosenSource||""===o.chosenSource)return u().createElement(u().Fragment,null,u().createElement(s.TextInput,{ouiaId:"instance_type_readonly",className:"pf-c-form-control",readOnly:!0,type:"text",value:"Select account to load instances",id:"input-readonly","aria-label":"Readonly input example"}));if(_)return console.warn("Failed to fetch instance types list"),u().createElement(u().Fragment,null,u().createElement(s.Alert,{ouiaId:"instance_type_alert",variant:"warning",isInline:!0,title:"There are problems fetching instance types"}),u().createElement(s.Select,{ouiaId:"instance_type_empty",isDisabled:!0,placeholderText:"No instance types found","aria-label":"Select instance type"}));if(T)return u().createElement(s.Spinner,{isSVG:!0,size:"sm","aria-label":"Contents of the small example"});var C=E||Z;return u().createElement(s.Select,(0,r.Z)({ouiaId:"select_instance_type",variant:"typeahead","aria-label":"Select instance type",placeholderText:"Select instance type",maxHeight:"450px",isOpen:d,selections:o.chosenInstanceType,onToggle:function(e){m(e)},onSelect:function(e,n,r){r?(t("error"),c((function(e){return G(G({},e),{},{chosenInstanceType:null})})),m(!1)):(c((function(e){return G(G({},e),{},{chosenInstanceType:n})})),t("success"),m(!1))},onFilter:function(e,t){var n=t.replace(/\\+$/,"");k!==n&&(v(5),I(n),w(Z.filter((function(e){return 0===e.name.search(n)}))))}},g<C.length&&{loadingVariant:{text:"View more (".concat(C.length-g,")"),onClick:function(){return v(g+5)}}}),function(e,t){return t<e.length&&(e=e.slice(0,t)),e.map((function(e,t){return u().createElement(s.SelectOption,{"aria-label":"Instance Type item",key:t,description:"".concat(e.cores," cores |\n          ").concat(e.vcpus," vCPU |\n          ").concat((parseFloat(e.memory_mib)/1024).toFixed(1)," GiB memory |\n          ").concat(e.storage_gb>0?e.storage_gb+" GB storage | ":"EBS only | ","\n          ").concat(e.architecture),value:e.name})}))}(C,g))};H.propTypes={setValidation:c().func.isRequired};const W=H,z=function(){var e=y(),t=(0,a.Z)(e,1)[0];return u().createElement(s.FormSelect,{ouiaId:"select_region",isDisabled:!0,"aria-label":"Select region",value:""},u().createElement(s.FormSelectOption,{label:t.chosenRegion,key:"placeholder",isPlaceholder:!0,value:""}))};function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U=function(e){var t=e.setStepValidated,n=y(),r=(0,a.Z)(n,1)[0],i=r.chosenSource,o=r.chosenInstanceType,c=u().useState({sources:i?"success":"default",types:o?"success":"default"}),l=(0,a.Z)(c,2),p=l[0],d=l[1];return u().useEffect((function(){var e=Object.values(p).some((function(e){return"success"!==e}));t(!e)}),[p]),u().createElement(s.Form,null,u().createElement(s.Title,{ouiaId:"account_custom_title",headingLevel:"h1",size:"xl"},"Account and customizations | AWS"),u().createElement(s.Text,{ouiaId:"account_custom_description"},"Configure instances that will run on your AWS. All the instances will launch with the same configuration."),u().createElement(s.FormGroup,{label:"Select account",validated:p.sources,helperTextInvalid:"Please pick a value",isRequired:!0,fieldId:"aws-select-source"},u().createElement(V,{setValidation:function(e){return d((function(t){return Q(Q({},t),{},{sources:e})}))}})),u().createElement(s.FormGroup,{label:"Select region",isRequired:!0,fieldId:"aws-select-region",labelIcon:u().createElement(s.Popover,{headerContent:u().createElement("div",null,"AWS regions")},u().createElement(s.Button,{ouiaId:"region_help",type:"button","aria-label":"More info for regions field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-region",className:"pf-c-form__group-label-help",variant:"plain"},u().createElement(S.ZP,{noVerticalAlign:!0})))},u().createElement(z,null)),u().createElement(s.FormGroup,{label:"Select instance type",isRequired:!0,helperTextInvalid:"Please pick a value",fieldId:"aws-select-instance-types",labelIcon:u().createElement(s.Popover,{headerContent:u().createElement("div",null,"AWS instance types")},u().createElement(s.Button,{ouiaId:"instance_type_help",type:"button","aria-label":"More info for instance types field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-types",className:"pf-c-form__group-label-help",variant:"plain"},u().createElement(S.ZP,{noVerticalAlign:!0})))},u().createElement(W,{setValidation:function(e){return d((function(t){return Q(Q({},t),{},{types:e})}))}})),u().createElement(s.FormGroup,{label:"Count",isRequired:!0,fieldId:"aws-select-instance-counter",labelIcon:u().createElement(s.Popover,{headerContent:u().createElement("div",null,"Number of ec2 AWS instances")},u().createElement(s.Button,{ouiaId:"instance_count_help",type:"button","aria-label":"More info for instance counter field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-counter",className:"pf-c-form__group-label-help",variant:"plain"},u().createElement(S.ZP,{noVerticalAlign:!0})))},u().createElement(q,null)))};U.propTypes={setStepValidated:c().func.isRequired};const J=U;var $=function(e){var t=e.imageName,n=y(),r=(0,a.Z)(n,1)[0],i=(0,b.useQuery)(O,T),o=i.error,c=i.data;return o&&console.log("Failed to fetch sources list"),u().createElement(s.DescriptionList,{isHorizontal:!0},u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,"Image"),u().createElement(s.DescriptionListDescription,null,t)),u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,"Account"),u().createElement(s.DescriptionListDescription,null,null==c?void 0:c.find((function(e){return e.id===r.chosenSource})).name)),u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,"Region"),u().createElement(s.DescriptionListDescription,null,r.chosenRegion)),u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,"Instance type"),u().createElement(s.DescriptionListDescription,null,r.chosenInstanceType)),u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,"Count"),u().createElement(s.DescriptionListDescription,null,r.chosenNumOfInstances)),u().createElement(s.DescriptionListGroup,null,u().createElement(s.DescriptionListTerm,null,r.uploadedKey?"New SSH key":"Existing SSH key"),u().createElement(s.DescriptionListDescription,null,r.uploadedKey?r.sshPublicName:r.chosenSshKeyName)))};$.propTypes={imageName:c().string.isRequired};const X=$;var Y=function(e){var t=e.imageName,n=u().useState(!0),r=(0,a.Z)(n,2),i=r[0],o=r[1];return u().createElement(s.ExpandableSection,{toggleText:"AWS",onToggle:function(e){o(e)},isExpanded:i,isIndented:!0},u().createElement(X,{imageName:t}))};Y.propTypes={imageName:c().string.isRequired};var ee=function(e){var t=e.imageName;return u().createElement("div",{className:"pf-c-form"},u().createElement(s.Title,{ouiaId:"review_details_title",headingLevel:"h1"},"Review details"),u().createElement(s.Text,{ouiaId:"review_details_description"},"Review the information below and click ",u().createElement("b",null,"Launch")," to complete provisioning."),u().createElement(Y,{imageName:t}))};ee.propTypes={imageName:c().string.isRequired};const te=ee;function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ae=function(e,t){return{id:e,toString:function(){return t},compareTo:function(t){return t.id==e}}},ie=function(e){var t=e.setStepValidated,n=y(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=u().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=u().useState(i.chosenSshKeyId?ae(i.chosenSshKeyId,i.chosenSshKeyName):null),f=(0,a.Z)(m,2),h=f[0],g=f[1];u().useEffect((function(){t(!!h)}),[h]);var v=(0,b.useQuery)(E,_),S=v.isLoading,O=v.isError,w=v.data;return S?u().createElement(s.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading saved SSH keys"}):O||w&&w.length<1?u().createElement(u().Fragment,null,O&&u().createElement(s.Alert,{ouiaId:"pubkey_alert",variant:"warning",isInline:!0,title:"There are problems fetching saved SSH keys"}),u().createElement(s.Select,{ouiaId:"pubkey_empty",isDisabled:!0,placeholderText:"No SSH key found","aria-label":"Select public key"})):u().createElement(s.Select,{ouiaId:"select_pubkey",onToggle:function(e){return d(e)},onSelect:function(e,t){o((function(e){return re(re({},e),{},{chosenSshKeyId:t.id,chosenSshKeyName:t.toString()})})),g(t),d(!1)},isOpen:p,selections:h,placeholderText:"Select public key...","aria-label":"Select public key"},w.map((function(e){var t=e.id,n=e.name;return u().createElement(s.SelectOption,{"aria-label":"Public key ".concat(n),key:t,value:ae(t,n)})})))};ie.propTypes={setStepValidated:c().func.isRequired};const oe=ie;function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=function(e){var t=e.setStepValidated,n=y(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=u().useState(),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=u().useState({sshKeyBody:"default",sshKeyName:"default"}),f=(0,a.Z)(m,2),b=f[0],h=f[1],g=u().useState(i.sshPublicName),S=(0,a.Z)(g,2),O=S[0],E=S[1],w=u().useState(i.sshPublicKey),P=(0,a.Z)(w,2),j=P[0],k=P[1];u().useEffect((function(){var e=Object.values(b).some((function(e){return"success"!==e}));t(!e)}),[b]);var I=function(e,t){return h((function(n){return se(se({},n),{},(0,v.Z)({},e,t))}))},D=function(e){return new RegExp("^(ssh|ecdsa)").test(e)};return u().createElement(u().Fragment,null,u().createElement(s.FormGroup,{validated:b.sshKeyName,helperTextInvalid:"Name is required",label:"Name",isRequired:!0,fieldId:"ssh-name"},u().createElement(s.TextInput,{ouiaId:"new_pubkey_name",validated:b.sshKeyName,value:O,id:"public-key-name",onChange:function(e){o((function(t){return se(se({},t),{},{sshPublicName:e})})),E(e)},onBlur:function(){0!==O.length?I("sshKeyName","success"):I("sshKeyName","error")},type:"text"})),u().createElement(s.FormGroup,{helperTextInvalid:"Must be SSH public key format",label:"SSH public key",isRequired:!0,fieldId:"ssh-file",validated:b.sshKeyBody},u().createElement(s.FileUpload,{ouiaId:"new_pubkey_file",id:"public-key-value",onDataChange:function(e){D(e)?(o((function(t){return se(se({},t),{},{sshPublicKey:e})})),k(e),I("sshKeyBody","success")):I("sshKeyBody","error")},allowEditingUploadedText:!0,onTextChange:function(e){o((function(t){return se(se({},t),{},{sshPublicKey:e})})),k(e)},onTextAreaBlur:function(){I("sshKeyBody",""===j?"default":D(j)?"success":"error")},type:"text",value:j,validated:b.sshKeyBody,onReadStarted:function(){d(!0)},onReadFinished:function(){d(!1)},onReadFailed:function(){o((function(e){return se(se({},e),{},{sshPublicName:"<Failed to load the file>"})})),I("sshKeyBody","error")},onClearClick:function(){o((function(e){return se(se({},e),{},{sshPublicName:void 0,sshPublicKey:void 0})})),k(""),I("sshKeyBody","default")},isLoading:p,filenamePlaceholder:"Drag a file here"})))};le.propTypes={setStepValidated:c().func.isRequired};const ue=le;function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var me="newKey",fe=function(e){var t=e.setStepValidated,n=y(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=(0,b.useQuery)(E,_),l=c.isLoading,p=c.isError,d=c.data,m=u().useState(!1),f=(0,a.Z)(m,2),h=f[0],g=f[1],v=function(e){o((function(t){return de(de({},t),{},{uploadedKey:me===e})}))},S=function(e,t){v(t.currentTarget.value)};return u().useEffect((function(){!l&&(p||d&&d.length<1)&&(g(!0),v(me))}),[l]),u().createElement(s.Form,{className:"pubkeys"},u().createElement(s.Title,{ouiaId:"pubkey_title",headingLevel:"h1"},"SSH keys authentication"),u().createElement(s.Text,{ouiaId:"pubkey_description"},"Establish secure, reliable communication and strong encryption to protect data."),u().createElement(s.FormGroup,{isRequired:!0,label:"Select a method to add SSH pubic key"},u().createElement(s.Radio,{id:"existing-pubkey-radio",ouiaId:"pubkey_radio",isChecked:!i.uploadedKey,isDisabled:h,name:"ssh-keys-radio",value:"existKey",onChange:S,label:"Select existing SSH public key","data-testid":"existing-pubkey-radio",body:(!i.uploadedKey||h)&&u().createElement(s.FormGroup,{label:"Select public key"},u().createElement(oe,{setStepValidated:t}))}),u().createElement(s.Radio,{id:"upload-pubkey-radio",ouiaId:"new_pubkey_radio",isChecked:i.uploadedKey,name:"ssh-keys-radio",value:me,onChange:S,label:"Add and save a new SSH public key",description:"Newly added key will be automatically saved. Result of the provisioning will not be affected this process.","data-testid":"upload-pubkey-radio",body:i.uploadedKey&&u().createElement(ue,{setStepValidated:t})})))};fe.propTypes={setStepValidated:c().func.isRequired};const ye=fe;var be=n(6948),he=n(5451),ge=n(4564),ve=[{description:"Uploading SSH public key",progress:0},{description:"Creating AWS reservation",progress:20},{description:"Waiting for AWS",progress:40},{description:"Launch is completed",progress:100}],Se=function(e){var t=e.onClose,n=e.imageID,r=y(),i=(0,a.Z)(r,1)[0],o=i.chosenSource,c=i.chosenInstanceType,l=i.chosenNumOfInstances,p=i.chosenRegion,d=i.sshPublicName,m=i.sshPublicKey,f=i.chosenSshKeyId,h=i.uploadedKey,g=u().useState(),v=(0,a.Z)(g,2),S=v[0],O=v[1],E=u().useState(h?0:1),w=(0,a.Z)(E,2),P=w[0],j=w[1],k=function(){return j((function(e){return e<ve.length-1?e+1:e}))},I=(0,b.useQuery)(["reservation",S],(function(){return N(S)}),{enabled:!!S,refetchInterval:500,refetchIntervalInBackground:!0}).data,D=(0,b.useMutation)(Z,{onSuccess:function(e){var t;k(),O(null==e||null===(t=e.data)||void 0===t?void 0:t.reservation_id)}}),T=D.mutate,_=D.error,x=(0,b.useMutation)(C,{onSuccess:function(e){var t;T({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:null==e||null===(t=e.data)||void 0===t?void 0:t.id}),k()}}),R=x.mutate,K=x.error;u().useEffect((function(){null!=I&&I.success&&(k(),O(void 0))}),[null==I?void 0:I.success]),u().useEffect((function(){h?R({name:d,body:m}):T({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:f})}),[]);var L,V,F=ve[P].progress,B=!1===(null==I?void 0:I.success),q=!!_||!!K||B;return q?(L="Launching system(s): Failure",V={color:"#C9190B",icon:ge.ZP}):100===F?(L="Launching system(s): Success",V={color:"#3E8635",icon:he.ZP}):(L="Launching your system(s)",V={icon:be.ZP}),u().createElement(s.WizardContextConsumer,null,(function(e){var n,r,a,i,o=e.goToStepById;return u().createElement(s.EmptyState,{variant:"large"},u().createElement(s.EmptyStateIcon,V),u().createElement(s.Title,{headingLevel:"h4",size:"lg",ouiaId:"launch-status"},L),u().createElement(s.EmptyStateBody,null,u().createElement(s.Progress,{style:{width:"500px"},variant:q&&"danger",value:F,measureLocation:"outside",id:"launch-progress"})),u().createElement(s.EmptyStateBody,null,u().createElement("span",null,q?"An error has occurred while ".concat(ve[P].description.toLowerCase()):ve[P].description,".",u().createElement("br",null),null==I?void 0:I.status,u().createElement("span",{className:"status-error"},null==_||null===(n=_.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg,null==K||null===(a=K.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.msg,null==I?void 0:I.error))),q&&u().createElement(s.Button,{onClick:function(){return o(1)},variant:"primary"},"Edit"),u().createElement(s.EmptyStateSecondaryActions,null,u().createElement(s.Button,{variant:"link",isDisabled:!q&&P<2,onClick:t},"Close")))}))};Se.propTypes={imageID:c().string.isRequired,onClose:c().func.isRequired};const Oe=Se;function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe=function(e){var t=e.isOpen,n=e.onConfirm,r=e.onCancel;return u().createElement(s.Modal,{ouiaId:"app-confirm-modal",id:"app-confirm-modal","aria-label":"confirm cancel of launch modal",variant:s.ModalVariant.small,title:"Exit instance launching?",isOpen:t,onClose:r,actions:[u().createElement(s.Button,{key:"exit",variant:"primary",onClick:n,ouiaId:"btn-exit-confirm"},"Exit"),u().createElement(s.Button,{key:"stay",variant:"link",onClick:r},"Stay")],titleIconVariant:"warning"},"All inputs will be discarded.")};Pe.propTypes={isOpen:c().bool.isRequired,onConfirm:c().func.isRequired,onCancel:c().func.isRequired};const je=Pe;var ke=["isOpen","onClose","image"],Ie={sshStep:!1,awsStep:!1},De=function(e){var t=e.isOpen,n=e.onClose,o=e.image,c=(0,i.Z)(e,ke),l=u().useState(1),p=(0,a.Z)(l,2),d=p[0],m=p[1],y=u().useState(Ie),b=(0,a.Z)(y,2),h=b[0],v=b[1],S=u().useState(!1),O=(0,a.Z)(S,2),E=O[0],w=O[1],P=function(){w(!1),m(1),v(Ie),n()},j=function(e){var t=e.stepIdReached,n=e.image,r=n.name,a=n.id,i=e.stepValidation,o=e.setStepValidation,c=e.onClose;return[{name:"Account and customization",steps:[{name:"AWS",id:1,enableNext:i.awsStep,component:u().createElement(J,{setStepValidated:function(e){return o((function(t){return we(we({},t),{},{awsStep:e})}))}}),canJumpTo:t>=1}]},{name:"SSH key authentication",id:4,component:u().createElement(ye,{setStepValidated:function(e){return o((function(t){return we(we({},t),{},{sshStep:e})}))}}),canJumpTo:t>=4,enableNext:i.sshStep},{name:"Review details",id:5,component:u().createElement(te,{imageName:r}),canJumpTo:t>=5,nextButtonText:"Launch"},{name:"Finish Progress",id:6,component:u().createElement(Oe,{onClose:c,imageID:a}),isFinishedStep:!0}]}({stepIdReached:d,image:o,stepValidation:h,setStepValidation:v,onClose:P});return t?u().createElement(f,null,u().createElement(g,null,u().createElement(s.Wizard,(0,r.Z)({},c,{title:"Provisioning",description:"Provision image ".concat(o.name),steps:j,isOpen:!0,onClose:function(){d>=5?w(!0):P()},onNext:function(e,t){var n=e.id,r=e.name,a=t.prevId,i=t.prevName;console.debug("current id: ".concat(n,", current name: ").concat(r,", previous id: ").concat(a,", previous name: ").concat(i)),m((function(e){return e<n?n:e}))},className:"provisioning"})),u().createElement(je,{isOpen:E,onConfirm:P,onCancel:function(){return w(!1)}}))):null};De.propTypes={isOpen:c().bool.isRequired,onClose:c().func,image:c().shape({name:c().string,id:c().string}).isRequired};const Te=De}}]);
//# sourceMappingURL=../sourcemaps/494.js.map