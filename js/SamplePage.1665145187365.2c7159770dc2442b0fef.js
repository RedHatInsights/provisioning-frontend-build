"use strict";(self.webpackChunkprovisioning_frontend=self.webpackChunkprovisioning_frontend||[]).push([[807],{805:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ce});var r=n(5861),a=n(885),i=n(7757),o=n.n(i),c=n(3264),s=n.n(c),l=n(6530),u=n(5834),p=n(4748),d=n(123),m=n(9173),f=n(5564),y=n.n(f),b=n(7462),h=n(5987),v=n(5697),g=n.n(v),S=n(3806);const O={chosenSource:void 0,chosenNumOfInstances:1,chosenInstanceType:void 0,uploadedKey:!1,chosenRegion:"us-east-1",sshPublicName:"",sshPublicKey:"",chosenSshKeyId:void 0,chosenSshKeyName:null};var E=(0,S.fH)((function(){return(0,c.useState)(O)})),w=E.Provider,P=E.useTracked,j=n(8767),k=new j.QueryClient;const D=function(e){var t=e.children;return s().createElement(j.QueryClientProvider,{client:k},t)};var T=n(4942),I=n(4213),x="sources",Z=function(e){return"/api/provisioning/v1/".concat(e)},C=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(Z("sources"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(Z("pubkeys"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=(0,r.Z)(o().mark((function e(t,n){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(Z("sources/".concat(t,"/instance_types?region=").concat(n)));case 2:return r=e.sent,a=r.data,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y().post(Z("reservations/aws"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y().post(Z("pubkeys"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=(0,r.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(Z("reservations/".concat(t)));case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function F(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?F(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e){var t=e.setValidation,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(null),f=(0,a.Z)(m,2),y=f[0],b=f[1],h=function(e,t){return{id:e,toString:function(){return t},compareTo:function(t){return t.id===e}}},v=(0,j.useQuery)(x,C,{onSuccess:function(e){var t=i.chosenSource;t&&b(h(t,e.find((function(e){return e.id===t})).name))}}),g=v.error,S=v.isLoading,O=v.data;return g?(console.warn("Failed to fetch sources list"),s().createElement(s().Fragment,null,s().createElement(u.Alert,{variant:"warning",isInline:!0,title:"There are problems fetching accounts"}),s().createElement(u.Select,{isDisabled:!0,placeholderText:"No accounts found","aria-label":"Select account"}))):S?s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading accounts"}):(console.log(O),s().createElement(u.Select,{isOpen:p,onToggle:function(e){return d(e)},selections:y,onSelect:function(e,n,r){r?(b(null),o((function(e){return A(A({},e),{},{chosenSource:null})})),t("error")):(b(n),o((function(e){return A(A({},e),{},{chosenSource:n.id})})),t("success")),d(!1)},placeholderText:"Select account","aria-label":"Select account"},O.map((function(e){var t=e.name,n=e.id;return s().createElement(u.SelectOption,{"aria-label":"Source account",key:n,value:h(n,t)})}))))};q.propTypes={setValidation:g().func.isRequired};const B=q;function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const H=function(){var e=P(),t=(0,a.Z)(e,2),n=t[0],r=t[1];return s().createElement(u.Slider,{max:45,min:1,value:n.chosenNumOfInstances,isInputVisible:!0,inputValue:n.chosenNumOfInstances,hasTooltipOverThumb:!0,onChange:function(e,t,n){var a;void 0===t?a=Number(e):t>45?(a=45,n(45)):t<1?(a=1,n(1)):a=Math.floor(t),r((function(e){return G(G({},e),{},{chosenNumOfInstances:a})}))}})};function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M=function(e){var t=e.setValidation,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(5),f=(0,a.Z)(m,2),y=f[0],h=f[1],v=s().useState(null),g=(0,a.Z)(v,2),S=g[0],O=g[1],E=s().useState(""),w=(0,a.Z)(E,2),k=w[0],D=w[1],T=(0,j.useQuery)(["instanceTypes",i.chosenSource,i.chosenRegion],(function(){return K(i.chosenSource,i.chosenRegion)}),{enabled:!!i.chosenSource}),I=T.isLoading,x=T.error,Z=T.data;if(!i.chosenSource||""===i.chosenSource)return s().createElement(s().Fragment,null,s().createElement("input",{className:"pf-c-form-control",readOnly:!0,type:"text",value:"Select account to load instances",id:"input-readonly","aria-label":"Readonly input example"}));if(x&&console.log("Failed to fetch instance types list"),I)return s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Contents of the small example"});var C=S||Z;return s().createElement(u.Select,(0,b.Z)({variant:"typeahead","aria-label":"Select instance type",placeholderText:"Select instance type",maxHeight:"450px",isOpen:p,selections:i.chosenInstanceType,onToggle:function(e){d(e)},onSelect:function(e,n,r){r?(t("error"),o((function(e){return z(z({},e),{},{chosenInstanceType:null})})),d(!1)):(o((function(e){return z(z({},e),{},{chosenInstanceType:n})})),t("success"),d(!1))},onFilter:function(e,t){k!==t&&h(5),O(Z.filter((function(e){return 0===e.name.search(t)}))),D(t)}},y<C.length&&{loadingVariant:{text:"View more (".concat(C.length-y,")"),onClick:function(){return h(y+5)}}}),function(e,t){return console.log(e,t),t<e.length&&(e=e.slice(0,t)),e.map((function(e,t){return s().createElement(u.SelectOption,{"aria-label":"Instance Type item",key:t,description:"".concat(e.cores," cores |\n          ").concat(e.vcpus," vCPU |\n          ").concat((parseFloat(e.memory_mib)/1024).toFixed(1)," GiB memory |\n          ").concat(e.storage_gb>0?e.storage_gb+" GB storage | ":"EBS only | ","\n          ").concat(e.architecture),value:e.name})}))}(C,y))};M.propTypes={setValidation:g().func.isRequired};const Q=M,U=function(){var e=P(),t=(0,a.Z)(e,1)[0];return s().createElement(u.FormSelect,{isDisabled:!0,"aria-label":"Select region",value:""},s().createElement(u.FormSelectOption,{label:t.chosenRegion,key:"placeholder",isPlaceholder:!0,value:""}))};function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,1)[0],i=r.chosenSource,o=r.chosenInstanceType,c=s().useState({sources:i?"success":"default",types:o?"success":"default"}),l=(0,a.Z)(c,2),p=l[0],d=l[1];return s().useEffect((function(){var e=Object.values(p).some((function(e){return"success"!==e}));t(!e)}),[p]),s().createElement(u.Form,null,s().createElement(u.Title,{headingLevel:"h1",size:"xl"},"Account and customizations | AWS"),s().createElement(u.Text,null,"Configure instances that will run on your AWS. All the instances will launch with the same configuration."),s().createElement(u.FormGroup,{label:"Select account",validated:p.sources,helperTextInvalid:"Please pick a value",isRequired:!0,fieldId:"aws-select-source"},s().createElement(B,{setValidation:function(e){return d((function(t){return X(X({},t),{},{sources:e})}))}})),s().createElement(u.FormGroup,{label:"Select region",isRequired:!0,fieldId:"aws-select-region",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"AWS regions")},s().createElement("button",{type:"button","aria-label":"More info for regions field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-region",className:"pf-c-form__group-label-help"},s().createElement(I.ZP,{noVerticalAlign:!0})))},s().createElement(U,null)),s().createElement(u.FormGroup,{label:"Select instance type",isRequired:!0,helperTextInvalid:"Please pick a value",fieldId:"aws-select-instance-types",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"AWS instance types")},s().createElement("button",{type:"button","aria-label":"More info for instance types field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-types",className:"pf-c-form__group-label-help"},s().createElement(I.ZP,{noVerticalAlign:!0})))},s().createElement(Q,{setValidation:function(e){return d((function(t){return X(X({},t),{},{types:e})}))}})),s().createElement(u.FormGroup,{label:"Count",isRequired:!0,fieldId:"aws-select-instance-counter",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"Number of ec2 AWS instances")},s().createElement("button",{type:"button","aria-label":"More info for instance counter field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-counter",className:"pf-c-form__group-label-help"},s().createElement(I.ZP,{noVerticalAlign:!0})))},s().createElement(H,null)))};Y.propTypes={setStepValidated:g().func.isRequired};const $=Y;var ee=function(e){var t=e.imageName,n=P(),r=(0,a.Z)(n,1)[0],i=(0,j.useQuery)(x,C),o=i.error,c=i.data;return o&&console.log("Failed to fetch sources list"),s().createElement(u.DescriptionList,{isHorizontal:!0},s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Image"),s().createElement(u.DescriptionListDescription,null,t)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Account"),s().createElement(u.DescriptionListDescription,null,null==c?void 0:c.find((function(e){return e.id===r.chosenSource})).name)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Region"),s().createElement(u.DescriptionListDescription,null,r.chosenRegion)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Instance type"),s().createElement(u.DescriptionListDescription,null,r.chosenInstanceType)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Count"),s().createElement(u.DescriptionListDescription,null,r.chosenNumOfInstances)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,r.uploadedKey?"New SSH key":"Existing SSH key"),s().createElement(u.DescriptionListDescription,null,r.uploadedKey?r.sshPublicName:r.chosenSshKeyName)))};ee.propTypes={imageName:g().string.isRequired};const te=ee;var ne=function(e){var t=e.imageName,n=s().useState(!0),r=(0,a.Z)(n,2),i=r[0],o=r[1];return s().createElement(u.ExpandableSection,{toggleText:"AWS",onToggle:function(e){o(e)},isExpanded:i,isIndented:!0},s().createElement(te,{imageName:t}))};ne.propTypes={imageName:g().string.isRequired};var re=function(e){var t=e.imageName;return s().createElement("div",{className:"pf-c-form"},s().createElement(u.Title,{headingLevel:"h1"},"Review details"),s().createElement(u.Text,null,"Review the information below and click ",s().createElement("b",null,"Launch")," to complete provisioning."),s().createElement(ne,{imageName:t}))};re.propTypes={imageName:g().string.isRequired};const ae=re;function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(i.chosenSshKeyId?{id:i.chosenSshKeyId,toString:function(){return i.chosenSshKeyName},compareTo:function(e){return e.id===i.chosenSshKeyId}}:null),f=(0,a.Z)(m,2),y=f[0],b=f[1];s().useEffect((function(){t(!!y)}),[y]);var h=(0,j.useQuery)("pubkeys",N),v=h.isLoading,g=h.isError,S=h.error,O=h.data;return g?(console.warn("Failed to fetch public SSH keys list: ".concat(S)),s().createElement(s().Fragment,null,s().createElement(u.Alert,{variant:"warning",isInline:!0,title:"There are problems fetching saved SSH keys"}),s().createElement(u.Select,{isDisabled:!0,placeholderText:"No SSH key found","aria-label":"Select public key"}))):v?s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading saved SSH keys"}):s().createElement(u.Select,{onToggle:function(e){return d(e)},onSelect:function(e,t){var n=t.id;o((function(e){var t;return oe(oe({},e),{},{chosenSshKeyId:n,chosenSshKeyName:null===(t=O.find((function(e){return e.id==n})))||void 0===t?void 0:t.name})})),b(t),d(!1)},onClear:function(){o((function(e){return oe(oe({},e),{},{chosenSshKeyId:void 0,chosenSshKeyName:null})})),b(null)},isOpen:p,selections:y,placeholderText:"Select public key","aria-label":"Select public key"},O.map((function(e){var t=e.id,n=e.name;return s().createElement(u.SelectOption,{"aria-label":"Public key ".concat(n),key:t,value:{id:t,toString:function(){return n},compareTo:function(e){return e.id==t}}})})))};ce.propTypes={setStepValidated:g().func.isRequired};const se=ce;function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var pe=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState({sshKeyBody:"default",sshKeyName:"default"}),f=(0,a.Z)(m,2),y=f[0],b=f[1];s().useEffect((function(){var e=Object.values(y).some((function(e){return"success"!==e}));t(!e)}),[y]);var h=function(e,t){return b((function(n){return ue(ue({},n),{},(0,T.Z)({},e,t))}))},v=function(e){return new RegExp("^(ssh|ecdsa)").test(e)};return s().createElement(s().Fragment,null,s().createElement(u.FormGroup,{validated:y.sshKeyName,helperTextInvalid:"a name is required",label:"Name",isRequired:!0,fieldId:"ssh-name"},s().createElement(u.TextInput,{validated:y.sshKeyName,value:i.sshPublicName,id:"public-key-name",onChange:function(e){o((function(t){return ue(ue({},t),{},{sshPublicName:e})})),0!==e.length?h("sshKeyName","success"):h("sshKeyName","error")},type:"text"})),s().createElement(u.FormGroup,{helperTextInvalid:"Must be SSH public key format",label:"SSH public key",isRequired:!0,fieldId:"ssh-file",validated:y.sshKeyBody},s().createElement(u.FileUpload,{id:"public-key-value",onDataChange:function(e){v(e)?(o((function(t){return ue(ue({},t),{},{sshPublicKey:e})})),h("sshKeyBody","success")):h("sshKeyBody","error")},allowEditingUploadedText:!0,onTextChange:function(e){o((function(t){return ue(ue({},t),{},{sshPublicKey:e})})),h("sshKeyBody",""===e?"default":v(e)?"success":"error")},type:"text",value:i.sshPublicKey,validated:y.sshKeyBody,onReadStarted:function(){d(!0)},onReadFinished:function(){d(!1)},onReadFailed:function(){o((function(e){return ue(ue({},e),{},{sshPublicName:"<Failed to load the file>"})})),h("sshKeyBody","error")},onClearClick:function(){o((function(e){return ue(ue({},e),{},{sshPublicName:void 0,sshPublicKey:void 0})})),h("sshKeyName","default"),h("sshKeyBody","default")},isLoading:p,filenamePlaceholder:"Drag a file here"})))};pe.propTypes={setStepValidated:g().func.isRequired};const de=pe;function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye="newKey",be=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=function(e,t){o((function(e){return fe(fe({},e),{},{uploadedKey:t.currentTarget.value==ye})}))};return s().createElement(u.Form,null,s().createElement(u.Title,{headingLevel:"h1"},"SSH keys authentication"),s().createElement(u.Text,null,"Establish secure, reliable communication and strong encryption to protect data."),s().createElement(u.Stack,{hasGutter:!0},s().createElement(u.StackItem,null,s().createElement(u.Title,{headingLevel:"h6"},"Select a method")),s().createElement(u.StackItem,null,s().createElement(u.Radio,{id:"existing-pubkey-radio",isChecked:!i.uploadedKey,name:"ssh-keys-radio",value:"existKey",onChange:c,label:"Select named SSH public key","data-testid":"existing-pubkey-radio",body:!i.uploadedKey&&s().createElement(se,{setStepValidated:t})})),s().createElement(u.StackItem,null,s().createElement(u.Radio,{id:"upload-pubkey-radio",isChecked:i.uploadedKey,name:"ssh-keys-radio",value:ye,onChange:c,label:"Add and save a new SSH public key",description:"Newly added key will be automatically saved. Result of the provisioning will not be affected this process","data-testid":"upload-pubkey-radio",body:i.uploadedKey&&s().createElement(de,{setStepValidated:t})}))))};be.propTypes={setStepValidated:g().func.isRequired};const he=be;var ve=n(6948),ge=n(8091),Se=n(3235),Oe=[{description:"Uploading SSH public key",progress:0},{description:"Creating AWS reservation",progress:20},{description:"Waiting for AWS",progress:40},{description:"Provisioning has been completed",progress:100}],Ee=function(e){var t=e.onClose,n=e.imageID,r=P(),i=(0,a.Z)(r,1)[0],o=i.chosenSource,c=i.chosenInstanceType,l=i.chosenNumOfInstances,p=i.chosenRegion,d=i.sshPublicName,m=i.sshPublicKey,f=i.chosenSshKeyId,y=i.uploadedKey,b=s().useState(),h=(0,a.Z)(b,2),v=h[0],g=h[1],S=s().useState(y?0:1),O=(0,a.Z)(S,2),E=O[0],w=O[1],k=function(){return w((function(e){return e<Oe.length-1?e+1:e}))},D=(0,j.useQuery)(["reservation",v],(function(){return V(v)}),{enabled:!!v,refetchInterval:500,refetchIntervalInBackground:!0}).data,T=(0,j.useMutation)(R,{onSuccess:function(e){var t;k(),g(null==e||null===(t=e.data)||void 0===t?void 0:t.reservation_id)}}),I=T.mutate,x=T.error,Z=(0,j.useMutation)(L,{onSuccess:function(e){var t;I({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:null==e||null===(t=e.data)||void 0===t?void 0:t.id}),k()}}),C=Z.mutate,N=Z.error;s().useEffect((function(){null!=D&&D.success&&(k(),g(void 0))}),[null==D?void 0:D.success]),s().useEffect((function(){y?C({name:d,body:m}):I({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:f})}),[]);var K=Oe[E].progress,F=!!D&&!1===D.success,A=!!x||!!N||F;return s().createElement(u.WizardContextConsumer,null,(function(e){var n,r,a,i,o=e.goToStepById;return s().createElement(u.EmptyState,{variant:"large"},s().createElement(u.EmptyStateIcon,{color:A?"#C9190B":100===K?"#3E8635":void 0,icon:A?Se.ZP:100===K?ge.ZP:ve.ZP}),s().createElement(u.Title,{headingLevel:"h4",size:"lg"},100===K?"Provisioning has been finished successfully":"Provisioning in progress"),s().createElement(u.EmptyStateBody,null,s().createElement(u.Progress,{style:{width:"500px"},variant:A&&"danger",value:K,measureLocation:"outside"})),s().createElement(u.EmptyStateBody,null,s().createElement("span",null,A?"An error has been occurred while ".concat(Oe[E].description.toLowerCase()):Oe[E].description,s().createElement("br",null),null==D?void 0:D.status,s().createElement("span",{className:"status-error"},null==x||null===(n=x.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg,null==N||null===(a=N.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.msg,null==D?void 0:D.error))),s().createElement(u.EmptyStateSecondaryActions,null,A&&s().createElement(u.Button,{onClick:function(){return o(1)},variant:"link"},"Back"),s().createElement(u.Button,{variant:"link",isDisabled:!(A||E>=2),onClick:t},"Close")))}))};Ee.propTypes={imageID:g().string.isRequired,onClose:g().func.isRequired};const we=Ee;function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke=function(e){var t=e.isOpen,n=e.onConfirm,r=e.onCancel;return s().createElement(u.Modal,{ouiaId:"app-confirm-modal",id:"app-confirm-modal","aria-label":"confirm cancel of launch modal",variant:u.ModalVariant.small,title:"Exit instance launching?",isOpen:t,onClose:r,actions:[s().createElement(u.Button,{key:"exit",variant:"primary",onClick:n,ouiaId:"btn-exit-confirm"},"Exit"),s().createElement(u.Button,{key:"stay",variant:"link",onClick:r},"Stay")],titleIconVariant:"warning"},"All inputs will be discarded.")};ke.propTypes={isOpen:g().bool.isRequired,onConfirm:g().func.isRequired,onCancel:g().func.isRequired};const De=ke;var Te=["isOpen","onClose","image"],Ie={sshStep:!1,awsStep:!1},xe=function(e){var t=e.isOpen,n=e.onClose,r=e.image,i=(0,h.Z)(e,Te),o=s().useState(1),c=(0,a.Z)(o,2),l=c[0],p=c[1],d=s().useState(Ie),m=(0,a.Z)(d,2),f=m[0],y=m[1],v=s().useState(!1),g=(0,a.Z)(v,2),S=g[0],O=g[1],E=function(){O(!1),p(1),y(Ie),n()},P=function(e){var t=e.stepIdReached,n=e.image,r=n.name,a=n.id,i=e.stepValidation,o=e.setStepValidation,c=e.onClose;return[{name:"Account and customization",steps:[{name:"AWS",id:1,enableNext:i.awsStep,component:s().createElement($,{setStepValidated:function(e){return o((function(t){return je(je({},t),{},{awsStep:e})}))}}),canJumpTo:t>=1}]},{name:"SSH key authentication",id:4,component:s().createElement(he,{setStepValidated:function(e){return o((function(t){return je(je({},t),{},{sshStep:e})}))}}),canJumpTo:t>=4,enableNext:i.sshStep},{name:"Review details",id:5,component:s().createElement(ae,{imageName:r}),canJumpTo:t>=5,nextButtonText:"Launch"},{name:"Finish Progress",id:6,component:s().createElement(we,{onClose:c,imageID:a}),isFinishedStep:!0}]}({stepIdReached:l,image:r,stepValidation:f,setStepValidation:y,onClose:E});return t?s().createElement(w,null,s().createElement(D,null,s().createElement(u.Wizard,(0,b.Z)({},i,{title:"Provisioning",description:"Provision image ".concat(r.name),steps:P,isOpen:!0,onClose:function(){l>=5?O(!0):E()},onNext:function(e,t){var n=e.id,r=e.name,a=t.prevId,i=t.prevName;console.debug("current id: ".concat(n,", current name: ").concat(r,", previous id: ").concat(a,", previous name: ").concat(i)),p((function(e){return e<n?n:e}))}})),s().createElement(De,{isOpen:S,onConfirm:E,onCancel:function(){return O(!1)}}))):null};xe.propTypes={isOpen:g().bool.isRequired,onClose:g().func,image:g().shape({name:g().string,id:g().string}).isRequired};const Ze=xe,Ce=(0,l.withRouter)((function(){var e=s().useState(!1),t=(0,a.Z)(e,2),n=t[0],i=t[1],l=s().useState([]),f=(0,a.Z)(l,2),b=f[0],h=f[1],v=s().useState({id:void 0,name:void 0}),g=(0,a.Z)(v,2),S=g[0],O=g[1],E=s().useState(!1),w=(0,a.Z)(E,2),P=w[0],j=w[1];(0,c.useEffect)((function(){var e,t,n,a=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y().get("/api/image-builder/v1/composes");case 3:t=e.sent,n=t.data,h(null==n?void 0:n.data),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.debug("No image builder api has been found"),h(!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null===(e=insights)||void 0===e||null===(t=e.chrome)||void 0===t||null===(n=t.appAction)||void 0===n||n.call(t,"sample-page"),a()}),[]);var k,D=function(e){j(e)},T=function(e,t,n){if(!n){var r=b.find((function(e){return e.image_name===t})).id;O({id:r,name:t}),j(!1)}};return k=b?function(e){return s().createElement(u.Select,{width:"33%",variant:u.SelectVariant.single,placeholderText:"Select an image","aria-label":"Select Image",onToggle:D,onSelect:T,selections:S.name,isOpen:P},null==e?void 0:e.map((function(e){return s().createElement(u.SelectOption,{key:e.id,value:e.image_name,description:"ID: ".concat(e.id)})})))}(b):s().createElement(u.FormGroup,{label:"Image AMI"},s().createElement(u.TextInput,{id:"ami",value:S.id||"",onChange:function(e){O({id:e,name:"manualy entered AMI"})}})),s().createElement(s().Fragment,null,s().createElement(d.Z,null,s().createElement(m.Z,{title:"Sample Provisioning App"}),s().createElement("p",null," Provisioning Demo ")),s().createElement(p.Z,null,s().createElement(u.Stack,{hasGutter:!0},s().createElement(u.StackItem,null,k),s().createElement(u.StackItem,null,s().createElement(u.Title,{headingLevel:"h2",size:"3xl"}),s().createElement(u.Button,{variant:"primary",onClick:function(){return i(!0)}},"Open Wizard"),s().createElement(Ze,{isOpen:n,onClose:function(){return i(!1)},image:S})))))}))}}]);
//# sourceMappingURL=../sourcemaps/SamplePage.fbae0f93cffe464e9f15873245a570a8.js.map