"use strict";(self.webpackChunkprovisioning_frontend=self.webpackChunkprovisioning_frontend||[]).push([[807],{805:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Re});var r=n(5861),a=n(885),i=n(7757),o=n.n(i),c=n(3264),s=n.n(c),l=n(6530),u=n(5834),p=n(4748),d=n(123),m=n(9173),f=n(5564),y=n.n(f),b=n(7462),h=n(5987),g=n(5697),v=n.n(g),S=n(3806);const E={chosenSource:void 0,chosenNumOfInstances:1,chosenInstanceType:void 0,uploadedKey:!1,chosenRegion:"us-east-1",sshPublicName:"",sshPublicKey:"",chosenSshKeyId:void 0,chosenSshKeyName:null};var O=(0,S.fH)((function(){return(0,c.useState)(E)})),w=O.Provider,P=O.useTracked,j=n(8767),k=new j.QueryClient;const D=function(e){var t=e.children;return s().createElement(j.QueryClientProvider,{client:k},t)};var T=n(4942),x=n(4213),I="sources",Z="pubkeys",C=function(e){return"/api/provisioning/v1/".concat(e)},N=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(C("sources"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(C("pubkeys"));case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=(0,r.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(C("instance_types/aws?region=".concat(t)));case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),L=function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y().post(C("reservations/aws"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=(0,r.Z)(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y().post(C("pubkeys"),t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=(0,r.Z)(o().mark((function e(t){var n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y().get(C("reservations/".concat(t)));case 2:return n=e.sent,r=n.data,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(e){var t=e.setValidation,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(null),f=(0,a.Z)(m,2),y=f[0],b=f[1],h=function(e,t){return{id:e,toString:function(){return t},compareTo:function(t){return t.id===e}}},g=(0,j.useQuery)(I,N,{onSuccess:function(e){var t=i.chosenSource;t&&b(h(t,e.find((function(e){return e.id===t})).name))}}),v=g.error,S=g.isLoading,E=g.data;return v?(console.warn("Failed to fetch sources list"),s().createElement(s().Fragment,null,s().createElement(u.Alert,{variant:"warning",isInline:!0,title:"There are problems fetching accounts"}),s().createElement(u.Select,{isDisabled:!0,placeholderText:"No accounts found","aria-label":"Select account"}))):S?s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading accounts"}):s().createElement(u.Select,{isOpen:p,onToggle:function(e){return d(e)},selections:y,onSelect:function(e,n,r){r?(b(null),o((function(e){return q(q({},e),{},{chosenSource:null})})),t("error")):(b(n),o((function(e){return q(q({},e),{},{chosenSource:n.id})})),t("success")),d(!1)},placeholderText:"Select account","aria-label":"Select account"},E.map((function(e){var t=e.name,n=e.id;return s().createElement(u.SelectOption,{"aria-label":"Source account",key:n,value:h(n,t)})})))};B.propTypes={setValidation:v().func.isRequired};const _=B;function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const W=function(){var e=P(),t=(0,a.Z)(e,2),n=t[0],r=t[1];return s().createElement(u.Slider,{max:45,min:1,value:n.chosenNumOfInstances,isInputVisible:!0,inputValue:n.chosenNumOfInstances,hasTooltipOverThumb:!0,onChange:function(e,t,n){var a;void 0===t?a=Number(e):t>45?(a=45,n(45)):t<1?(a=1,n(1)):a=Math.floor(t),r((function(e){return H(H({},e),{},{chosenNumOfInstances:a})}))}})};function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=function(e){var t=e.setValidation,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(5),f=(0,a.Z)(m,2),y=f[0],h=f[1],g=s().useState(null),v=(0,a.Z)(g,2),S=v[0],E=v[1],O=s().useState(""),w=(0,a.Z)(O,2),k=w[0],D=w[1],T=(0,j.useQuery)(["instanceTypes",i.chosenRegion],(function(){return K(i.chosenRegion)})),x=T.isLoading,I=T.error,Z=T.data;if(!i.chosenSource||""===i.chosenSource)return s().createElement(s().Fragment,null,s().createElement("input",{className:"pf-c-form-control",readOnly:!0,type:"text",value:"Select account to load instances",id:"input-readonly","aria-label":"Readonly input example"}));if(I)return console.warn("Failed to fetch instance types list"),s().createElement(s().Fragment,null,s().createElement(u.Alert,{variant:"warning",isInline:!0,title:"There are problems fetching instance types"}),s().createElement(u.Select,{isDisabled:!0,placeholderText:"No instance types found","aria-label":"Select instance type"}));if(x)return s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Contents of the small example"});var C=S||Z;return s().createElement(u.Select,(0,b.Z)({variant:"typeahead","aria-label":"Select instance type",placeholderText:"Select instance type",maxHeight:"450px",isOpen:p,selections:i.chosenInstanceType,onToggle:function(e){d(e)},onSelect:function(e,n,r){r?(t("error"),o((function(e){return M(M({},e),{},{chosenInstanceType:null})})),d(!1)):(o((function(e){return M(M({},e),{},{chosenInstanceType:n})})),t("success"),d(!1))},onFilter:function(e,t){k!==t&&h(5),E(Z.filter((function(e){return 0===e.name.search(t)}))),D(t)}},y<C.length&&{loadingVariant:{text:"View more (".concat(C.length-y,")"),onClick:function(){return h(y+5)}}}),function(e,t){return t<e.length&&(e=e.slice(0,t)),e.map((function(e,t){return s().createElement(u.SelectOption,{"aria-label":"Instance Type item",key:t,description:"".concat(e.cores," cores |\n          ").concat(e.vcpus," vCPU |\n          ").concat((parseFloat(e.memory_mib)/1024).toFixed(1)," GiB memory |\n          ").concat(e.storage_gb>0?e.storage_gb+" GB storage | ":"EBS only | ","\n          ").concat(e.architecture),value:e.name})}))}(C,y))};Q.propTypes={setValidation:v().func.isRequired};const U=Q,J=function(){var e=P(),t=(0,a.Z)(e,1)[0];return s().createElement(u.FormSelect,{isDisabled:!0,"aria-label":"Select region",value:""},s().createElement(u.FormSelectOption,{label:t.chosenRegion,key:"placeholder",isPlaceholder:!0,value:""}))};function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,1)[0],i=r.chosenSource,o=r.chosenInstanceType,c=s().useState({sources:i?"success":"default",types:o?"success":"default"}),l=(0,a.Z)(c,2),p=l[0],d=l[1];return s().useEffect((function(){var e=Object.values(p).some((function(e){return"success"!==e}));t(!e)}),[p]),s().createElement(u.Form,null,s().createElement(u.Title,{headingLevel:"h1",size:"xl"},"Account and customizations | AWS"),s().createElement(u.Text,null,"Configure instances that will run on your AWS. All the instances will launch with the same configuration."),s().createElement(u.FormGroup,{label:"Select account",validated:p.sources,helperTextInvalid:"Please pick a value",isRequired:!0,fieldId:"aws-select-source"},s().createElement(_,{setValidation:function(e){return d((function(t){return Y(Y({},t),{},{sources:e})}))}})),s().createElement(u.FormGroup,{label:"Select region",isRequired:!0,fieldId:"aws-select-region",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"AWS regions")},s().createElement("button",{type:"button","aria-label":"More info for regions field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-region",className:"pf-c-form__group-label-help"},s().createElement(x.ZP,{noVerticalAlign:!0})))},s().createElement(J,null)),s().createElement(u.FormGroup,{label:"Select instance type",isRequired:!0,helperTextInvalid:"Please pick a value",fieldId:"aws-select-instance-types",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"AWS instance types")},s().createElement("button",{type:"button","aria-label":"More info for instance types field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-types",className:"pf-c-form__group-label-help"},s().createElement(x.ZP,{noVerticalAlign:!0})))},s().createElement(U,{setValidation:function(e){return d((function(t){return Y(Y({},t),{},{types:e})}))}})),s().createElement(u.FormGroup,{label:"Count",isRequired:!0,fieldId:"aws-select-instance-counter",labelIcon:s().createElement(u.Popover,{headerContent:s().createElement("div",null,"Number of ec2 AWS instances")},s().createElement("button",{type:"button","aria-label":"More info for instance counter field",onClick:function(e){return e.preventDefault()},"aria-describedby":"aws-select-instance-counter",className:"pf-c-form__group-label-help"},s().createElement(x.ZP,{noVerticalAlign:!0})))},s().createElement(W,null)))};$.propTypes={setStepValidated:v().func.isRequired};const ee=$;var te=function(e){var t=e.imageName,n=P(),r=(0,a.Z)(n,1)[0],i=(0,j.useQuery)(I,N),o=i.error,c=i.data;return o&&console.log("Failed to fetch sources list"),s().createElement(u.DescriptionList,{isHorizontal:!0},s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Image"),s().createElement(u.DescriptionListDescription,null,t)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Account"),s().createElement(u.DescriptionListDescription,null,null==c?void 0:c.find((function(e){return e.id===r.chosenSource})).name)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Region"),s().createElement(u.DescriptionListDescription,null,r.chosenRegion)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Instance type"),s().createElement(u.DescriptionListDescription,null,r.chosenInstanceType)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,"Count"),s().createElement(u.DescriptionListDescription,null,r.chosenNumOfInstances)),s().createElement(u.DescriptionListGroup,null,s().createElement(u.DescriptionListTerm,null,r.uploadedKey?"New SSH key":"Existing SSH key"),s().createElement(u.DescriptionListDescription,null,r.uploadedKey?r.sshPublicName:r.chosenSshKeyName)))};te.propTypes={imageName:v().string.isRequired};const ne=te;var re=function(e){var t=e.imageName,n=s().useState(!0),r=(0,a.Z)(n,2),i=r[0],o=r[1];return s().createElement(u.ExpandableSection,{toggleText:"AWS",onToggle:function(e){o(e)},isExpanded:i,isIndented:!0},s().createElement(ne,{imageName:t}))};re.propTypes={imageName:v().string.isRequired};var ae=function(e){var t=e.imageName;return s().createElement("div",{className:"pf-c-form"},s().createElement(u.Title,{headingLevel:"h1"},"Review details"),s().createElement(u.Text,null,"Review the information below and click ",s().createElement("b",null,"Launch")," to complete provisioning."),s().createElement(re,{imageName:t}))};ae.propTypes={imageName:v().string.isRequired};const ie=ae;function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ce(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se=function(e,t){return{id:e,toString:function(){return t},compareTo:function(t){return t.id==e}}},le=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(!1),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState(i.chosenSshKeyId?se(i.chosenSshKeyId,i.chosenSshKeyName):null),f=(0,a.Z)(m,2),y=f[0],b=f[1];s().useEffect((function(){t(!!y)}),[y]);var h=(0,j.useQuery)(Z,R),g=h.isLoading,v=h.isError,S=h.data;return g?s().createElement(u.Spinner,{isSVG:!0,size:"sm","aria-label":"Loading saved SSH keys"}):v||S&&S.length<1?s().createElement(s().Fragment,null,v&&s().createElement(u.Alert,{variant:"warning",isInline:!0,title:"There are problems fetching saved SSH keys"}),s().createElement(u.Select,{isDisabled:!0,placeholderText:"No SSH key found","aria-label":"Select public key"})):s().createElement(u.Select,{onToggle:function(e){return d(e)},onSelect:function(e,t){o((function(e){return ce(ce({},e),{},{chosenSshKeyId:t.id,chosenSshKeyName:t.toString()})})),b(t),d(!1)},isOpen:p,selections:y,placeholderText:"Select public key...","aria-label":"Select public key"},S.map((function(e){var t=e.id,n=e.name;return s().createElement(u.SelectOption,{"aria-label":"Public key ".concat(n),key:t,value:se(t,n)})})))};le.propTypes={setStepValidated:v().func.isRequired};const ue=le;function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var me=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=s().useState(),l=(0,a.Z)(c,2),p=l[0],d=l[1],m=s().useState({sshKeyBody:"default",sshKeyName:"default"}),f=(0,a.Z)(m,2),y=f[0],b=f[1];s().useEffect((function(){var e=Object.values(y).some((function(e){return"success"!==e}));t(!e)}),[y]);var h=function(e,t){return b((function(n){return de(de({},n),{},(0,T.Z)({},e,t))}))},g=function(e){return new RegExp("^(ssh|ecdsa)").test(e)};return s().createElement(s().Fragment,null,s().createElement(u.FormGroup,{validated:y.sshKeyName,helperTextInvalid:"Name is required",label:"Name",isRequired:!0,fieldId:"ssh-name"},s().createElement(u.TextInput,{validated:y.sshKeyName,value:i.sshPublicName,id:"public-key-name",onChange:function(e){o((function(t){return de(de({},t),{},{sshPublicName:e})})),0!==e.length?h("sshKeyName","success"):h("sshKeyName","error")},type:"text"})),s().createElement(u.FormGroup,{helperTextInvalid:"Must be SSH public key format",label:"SSH public key",isRequired:!0,fieldId:"ssh-file",validated:y.sshKeyBody},s().createElement(u.FileUpload,{id:"public-key-value",onDataChange:function(e){g(e)?(o((function(t){return de(de({},t),{},{sshPublicKey:e})})),h("sshKeyBody","success")):h("sshKeyBody","error")},allowEditingUploadedText:!0,onTextChange:function(e){o((function(t){return de(de({},t),{},{sshPublicKey:e})})),h("sshKeyBody",""===e?"default":g(e)?"success":"error")},type:"text",value:i.sshPublicKey,validated:y.sshKeyBody,onReadStarted:function(){d(!0)},onReadFinished:function(){d(!1)},onReadFailed:function(){o((function(e){return de(de({},e),{},{sshPublicName:"<Failed to load the file>"})})),h("sshKeyBody","error")},onClearClick:function(){o((function(e){return de(de({},e),{},{sshPublicName:void 0,sshPublicKey:void 0})})),h("sshKeyName","default"),h("sshKeyBody","default")},isLoading:p,filenamePlaceholder:"Drag a file here"})))};me.propTypes={setStepValidated:v().func.isRequired};const fe=me;function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he="newKey",ge=function(e){var t=e.setStepValidated,n=P(),r=(0,a.Z)(n,2),i=r[0],o=r[1],c=(0,j.useQuery)(Z,R),l=c.isLoading,p=c.isError,d=c.data,m=s().useState(!1),f=(0,a.Z)(m,2),y=f[0],b=f[1],h=function(e){o((function(t){return be(be({},t),{},{uploadedKey:he===e})}))},g=function(e,t){h(t.currentTarget.value)};return s().useEffect((function(){!l&&(p||d&&d.length<1)&&(b(!0),h(he))}),[l]),s().createElement(u.Form,{className:"pubkeys"},s().createElement(u.Title,{headingLevel:"h1"},"SSH keys authentication"),s().createElement(u.Text,null,"Establish secure, reliable communication and strong encryption to protect data."),s().createElement(u.FormGroup,{isRequired:!0,label:"Select a method to add SSH pubic key"},s().createElement(u.Radio,{id:"existing-pubkey-radio",isChecked:!i.uploadedKey,isDisabled:y,name:"ssh-keys-radio",value:"existKey",onChange:g,label:"Select existing SSH public key","data-testid":"existing-pubkey-radio",body:(!i.uploadedKey||y)&&s().createElement(u.FormGroup,{label:"Select public key"},s().createElement(ue,{setStepValidated:t}))}),s().createElement(u.Radio,{id:"upload-pubkey-radio",isChecked:i.uploadedKey,name:"ssh-keys-radio",value:he,onChange:g,label:"Add and save a new SSH public key",description:"Newly added key will be automatically saved. Result of the provisioning will not be affected this process.","data-testid":"upload-pubkey-radio",body:i.uploadedKey&&s().createElement(fe,{setStepValidated:t})})))};ge.propTypes={setStepValidated:v().func.isRequired};const ve=ge;var Se=n(6948),Ee=n(8091),Oe=n(3235),we=[{description:"Uploading SSH public key",progress:0},{description:"Creating AWS reservation",progress:20},{description:"Waiting for AWS",progress:40},{description:"Provisioning has been completed",progress:100}],Pe=function(e){var t=e.onClose,n=e.imageID,r=P(),i=(0,a.Z)(r,1)[0],o=i.chosenSource,c=i.chosenInstanceType,l=i.chosenNumOfInstances,p=i.chosenRegion,d=i.sshPublicName,m=i.sshPublicKey,f=i.chosenSshKeyId,y=i.uploadedKey,b=s().useState(),h=(0,a.Z)(b,2),g=h[0],v=h[1],S=s().useState(y?0:1),E=(0,a.Z)(S,2),O=E[0],w=E[1],k=function(){return w((function(e){return e<we.length-1?e+1:e}))},D=(0,j.useQuery)(["reservation",g],(function(){return F(g)}),{enabled:!!g,refetchInterval:500,refetchIntervalInBackground:!0}).data,T=(0,j.useMutation)(L,{onSuccess:function(e){var t;k(),v(null==e||null===(t=e.data)||void 0===t?void 0:t.reservation_id)}}),x=T.mutate,I=T.error,Z=(0,j.useMutation)(V,{onSuccess:function(e){var t;x({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:null==e||null===(t=e.data)||void 0===t?void 0:t.id}),k()}}),C=Z.mutate,N=Z.error;s().useEffect((function(){null!=D&&D.success&&(k(),v(void 0))}),[null==D?void 0:D.success]),s().useEffect((function(){y?C({name:d,body:m}):x({source_id:o,instance_type:c,amount:l,image_id:n,region:p,pubkey_id:f})}),[]);var R=we[O].progress,K=!!D&&!1===D.success,A=!!I||!!N||K;return s().createElement(u.WizardContextConsumer,null,(function(e){var n,r,a,i,o=e.goToStepById;return s().createElement(u.EmptyState,{variant:"large"},s().createElement(u.EmptyStateIcon,{color:A?"#C9190B":100===R?"#3E8635":void 0,icon:A?Oe.ZP:100===R?Ee.ZP:Se.ZP}),s().createElement(u.Title,{headingLevel:"h4",size:"lg"},100===R?"Provisioning has been finished successfully":"Provisioning in progress"),s().createElement(u.EmptyStateBody,null,s().createElement(u.Progress,{style:{width:"500px"},variant:A&&"danger",value:R,measureLocation:"outside"})),s().createElement(u.EmptyStateBody,null,s().createElement("span",null,A?"An error has been occurred while ".concat(we[O].description.toLowerCase()):we[O].description,s().createElement("br",null),null==D?void 0:D.status,s().createElement("span",{className:"status-error"},null==I||null===(n=I.response)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.msg,null==N||null===(a=N.response)||void 0===a||null===(i=a.data)||void 0===i?void 0:i.msg,null==D?void 0:D.error))),s().createElement(u.EmptyStateSecondaryActions,null,A&&s().createElement(u.Button,{onClick:function(){return o(1)},variant:"link"},"Back"),s().createElement(u.Button,{variant:"link",isDisabled:!(A||O>=2),onClick:t},"Close")))}))};Pe.propTypes={imageID:v().string.isRequired,onClose:v().func.isRequired};const je=Pe;function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Te=function(e){var t=e.isOpen,n=e.onConfirm,r=e.onCancel;return s().createElement(u.Modal,{ouiaId:"app-confirm-modal",id:"app-confirm-modal","aria-label":"confirm cancel of launch modal",variant:u.ModalVariant.small,title:"Exit instance launching?",isOpen:t,onClose:r,actions:[s().createElement(u.Button,{key:"exit",variant:"primary",onClick:n,ouiaId:"btn-exit-confirm"},"Exit"),s().createElement(u.Button,{key:"stay",variant:"link",onClick:r},"Stay")],titleIconVariant:"warning"},"All inputs will be discarded.")};Te.propTypes={isOpen:v().bool.isRequired,onConfirm:v().func.isRequired,onCancel:v().func.isRequired};const xe=Te;var Ie=["isOpen","onClose","image"],Ze={sshStep:!1,awsStep:!1},Ce=function(e){var t=e.isOpen,n=e.onClose,r=e.image,i=(0,h.Z)(e,Ie),o=s().useState(1),c=(0,a.Z)(o,2),l=c[0],p=c[1],d=s().useState(Ze),m=(0,a.Z)(d,2),f=m[0],y=m[1],g=s().useState(!1),v=(0,a.Z)(g,2),S=v[0],E=v[1],O=function(){E(!1),p(1),y(Ze),n()},P=function(e){var t=e.stepIdReached,n=e.image,r=n.name,a=n.id,i=e.stepValidation,o=e.setStepValidation,c=e.onClose;return[{name:"Account and customization",steps:[{name:"AWS",id:1,enableNext:i.awsStep,component:s().createElement(ee,{setStepValidated:function(e){return o((function(t){return De(De({},t),{},{awsStep:e})}))}}),canJumpTo:t>=1}]},{name:"SSH key authentication",id:4,component:s().createElement(ve,{setStepValidated:function(e){return o((function(t){return De(De({},t),{},{sshStep:e})}))}}),canJumpTo:t>=4,enableNext:i.sshStep},{name:"Review details",id:5,component:s().createElement(ie,{imageName:r}),canJumpTo:t>=5,nextButtonText:"Launch"},{name:"Finish Progress",id:6,component:s().createElement(je,{onClose:c,imageID:a}),isFinishedStep:!0}]}({stepIdReached:l,image:r,stepValidation:f,setStepValidation:y,onClose:O});return t?s().createElement(w,null,s().createElement(D,null,s().createElement(u.Wizard,(0,b.Z)({},i,{title:"Provisioning",description:"Provision image ".concat(r.name),steps:P,isOpen:!0,onClose:function(){l>=5?E(!0):O()},onNext:function(e,t){var n=e.id,r=e.name,a=t.prevId,i=t.prevName;console.debug("current id: ".concat(n,", current name: ").concat(r,", previous id: ").concat(a,", previous name: ").concat(i)),p((function(e){return e<n?n:e}))}})),s().createElement(xe,{isOpen:S,onConfirm:O,onCancel:function(){return E(!1)}}))):null};Ce.propTypes={isOpen:v().bool.isRequired,onClose:v().func,image:v().shape({name:v().string,id:v().string}).isRequired};const Ne=Ce,Re=(0,l.withRouter)((function(){var e=s().useState(!1),t=(0,a.Z)(e,2),n=t[0],i=t[1],l=s().useState([]),f=(0,a.Z)(l,2),b=f[0],h=f[1],g=s().useState({id:void 0,name:void 0}),v=(0,a.Z)(g,2),S=v[0],E=v[1],O=s().useState(!1),w=(0,a.Z)(O,2),P=w[0],j=w[1];(0,c.useEffect)((function(){var e,t,n,a=function(){var e=(0,r.Z)(o().mark((function e(){var t,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y().get("/api/image-builder/v1/composes");case 3:t=e.sent,n=t.data,h(null==n?void 0:n.data),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.debug("No image builder api has been found"),h(!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();null===(e=insights)||void 0===e||null===(t=e.chrome)||void 0===t||null===(n=t.appAction)||void 0===n||n.call(t,"sample-page"),a()}),[]);var k,D=function(e){j(e)},T=function(e,t,n){if(!n){var r=b.find((function(e){return e.image_name===t})).id;E({id:r,name:t}),j(!1)}};return k=b?function(e){return s().createElement(u.Select,{width:"33%",variant:u.SelectVariant.single,placeholderText:"Select an image","aria-label":"Select Image",onToggle:D,onSelect:T,selections:S.name,isOpen:P},null==e?void 0:e.map((function(e){return s().createElement(u.SelectOption,{key:e.id,value:e.image_name,description:"ID: ".concat(e.id)})})))}(b):s().createElement(u.FormGroup,{label:"Image AMI"},s().createElement(u.TextInput,{id:"ami",value:S.id||"",onChange:function(e){E({id:e,name:"manualy entered AMI"})}})),s().createElement(s().Fragment,null,s().createElement(d.Z,null,s().createElement(m.Z,{title:"Sample Provisioning App"}),s().createElement("p",null," Provisioning Demo ")),s().createElement(p.Z,null,s().createElement(u.Stack,{hasGutter:!0},s().createElement(u.StackItem,null,k),s().createElement(u.StackItem,null,s().createElement(u.Title,{headingLevel:"h2",size:"3xl"}),s().createElement(u.Button,{variant:"primary",onClick:function(){return i(!0)}},"Open Wizard"),s().createElement(Ne,{isOpen:n,onClose:function(){return i(!1)},image:S})))))}))}}]);
//# sourceMappingURL=../sourcemaps/SamplePage.e0dcb3ee10c6c06b1fdea1a71da03e9d.js.map